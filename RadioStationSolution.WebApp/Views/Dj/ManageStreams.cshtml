@model IEnumerable<OnlineRadioStation.Domain.DjStream>
@{
    ViewData["Title"] = "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –µ—Ñ—ñ—Ä–æ–º";
    
    // –û—Ç—Ä–∏–º—É—î–º–æ —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞
    bool isAnyLive = ViewBag.IsLive ?? false;     // –ß–∏ –π–¥–µ —Ö–æ—á —è–∫–∏–π—Å—å –µ—Ñ—ñ—Ä
    bool isMicLive = ViewBag.IsMicLive ?? false;  // –ß–∏ —Ü–µ –º—ñ–∫—Ä–æ—Ñ–æ–Ω
    bool isDbLive = ViewBag.IsDbLive ?? false;    // –ß–∏ —Ü–µ –ø–ª–µ–π–ª–∏—Å—Ç –∑ –±–∞–∑–∏
    bool isRandom = ViewBag.IsRandom ?? false;
    
    var playlist = ViewBag.CurrentPlaylist as IEnumerable<OnlineRadioStation.Domain.PlaybackQueue>;
}

<div class="container">
    <h1>üéõÔ∏è –ï—Ñ—ñ—Ä–Ω–∏–π –ø—É–ª—å—Ç</h1>
    <hr />

    <div class="card mb-4 text-center shadow-sm @(isAnyLive ? "border-success" : "border-secondary")">
        <div class="card-body">
            @if (isAnyLive)
            {
                <h2 class="text-success animate-pulse">üî¥ –í –ï–§–Ü–†–Ü (ON AIR)</h2>
                
                @if (isMicLive)
                {
                    <p class="text-muted fw-bold">üéôÔ∏è –î–∂–µ—Ä–µ–ª–æ: –ñ–∏–≤–∏–π –∑–≤—É–∫ (–ú—ñ–∫—Ä–æ—Ñ–æ–Ω / –í—ñ–Ω—ñ–ª)</p>
                    <div class="alert alert-warning d-inline-block">
                        –£–≤–∞–≥–∞: –ü–ª–µ–π–ª–∏—Å—Ç —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–∞–≥–ª—É—à–µ–Ω–æ.
                    </div>
                    <div class="mt-4">
                        <button id="btnStopMic" class="btn btn-danger btn-lg px-5" onclick="stopStreaming()">
                            –ó–ê–í–ï–†–®–ò–¢–ò LIVE –°–¢–†–Ü–ú
                        </button>
                    </div>
                }
                else if (isDbLive)
                {
                    <p class="text-muted fw-bold">üéµ –î–∂–µ—Ä–µ–ª–æ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–ª–µ–π–ª–∏—Å—Ç</p>
                    <div class="my-3 p-3 bg-light rounded border">
                        <h1 id="liveTimer" class="display-4 fw-bold text-dark" style="font-family: monospace;">00:00:00</h1>
                        <small class="text-muted">—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å–µ—Å—ñ—ó</small>
                    </div>

                    @if (isRandom)
                    {
                        <div class="alert alert-info d-inline-block">
                            <i class="bi bi-shuffle"></i> –†–µ–∂–∏–º Shuffle
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-secondary d-inline-block">
                            <i class="bi bi-list-ol"></i> –ó–∞ –ø–æ—Ä—è–¥–∫–æ–º
                        </div>
                    }

                    <form asp-action="ToggleStream" method="post" class="mt-4">
                        <input type="hidden" name="action" value="stop" />
                        <button type="submit" class="btn btn-danger btn-lg px-5">
                            –ó–ê–í–ï–†–®–ò–¢–ò –ï–§–Ü–†
                        </button>
                    </form>
                }
            }
            else
            {
                <h2 class="text-secondary">–û–§–õ–ê–ô–ù</h2>
                <p class="text-muted">–ï—Ñ—ñ—Ä –∑—É–ø–∏–Ω–µ–Ω–æ. –û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫—É:</p>

                <ul class="nav nav-pills justify-content-center mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pills-playlist-tab" data-bs-toggle="pill" data-bs-target="#pills-playlist" type="button" role="tab">
                            <i class="bi bi-music-note-list"></i> –ê–≤—Ç–æ-–î—ñ–¥–∂–µ–π (–ü–ª–µ–π–ª–∏—Å—Ç)
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pills-live-tab" data-bs-toggle="pill" data-bs-target="#pills-live" type="button" role="tab">
                            <i class="bi bi-mic-fill"></i> Live Studio (–ú—ñ–∫—Ä–æ—Ñ–æ–Ω/–í—ñ–Ω—ñ–ª)
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="pills-tabContent">
                    
                    <div class="tab-pane fade show active" id="pills-playlist" role="tabpanel">
                        <div class="card card-body bg-light mx-auto" style="max-width: 500px;">
                            <form asp-action="ToggleStream" method="post">
                                <input type="hidden" name="action" value="start" />
                                <div class="mb-3 text-start form-check form-switch">
                                    <input type="checkbox" class="form-check-input" id="startRandom" name="startRandom" value="true">
                                    <label class="form-check-label" for="startRandom">
                                        –í–∏–ø–∞–¥–∫–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫ (Shuffle)
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="bi bi-play-circle"></i> –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ü–ª–µ–π–ª–∏—Å—Ç
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="pills-live" role="tabpanel">
                        <div class="card card-body bg-light mx-auto" style="max-width: 500px;">
                            <div class="mb-3 text-start">
                                <label class="form-label fw-bold">–î–∂–µ—Ä–µ–ª–æ –∑–≤—É–∫—É:</label>
                                <select id="audioSource" class="form-select"></select>
                                <div class="form-text">
                                    –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤—ñ–Ω—ñ–ª–æ–≤–∏–π –ø—Ä–æ–≥—Ä–∞–≤–∞—á —è–∫ "Line In" –∞–±–æ –æ–±–µ—Ä—ñ—Ç—å –º—ñ–∫—Ä–æ—Ñ–æ–Ω.
                                </div>
                            </div>
                            <div id="connectionStatus" class="alert alert-info d-none">
                                –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...
                            </div>
                            <button id="btnStartMic" class="btn btn-danger w-100" onclick="startStreaming()">
                                <i class="bi bi-broadcast"></i> –í–∏–π—Ç–∏ –≤ Live –ï—Ñ—ñ—Ä
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    @if (isAnyLive)
    {
        <div class="card border-primary mb-4 shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <span>üì° –ú–æ–Ω—ñ—Ç–æ—Ä —Å–ª—É—Ö–∞—á–∞</span>
                <span class="badge bg-light text-dark" id="monitorStatus">–û–Ω–æ–≤–ª–µ–Ω–Ω—è...</span>
            </div>
            <div class="card-body d-flex align-items-center gap-3">
                <div class="text-primary bg-light rounded-circle p-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                    <i class="bi bi-headphones fs-3"></i>
                </div>
                <div class="flex-grow-1">
                    <h5 class="mb-0 fw-bold" id="monitorTitle">
                        @(isMicLive ? "üéôÔ∏è –ü—Ä—è–º–µ –≤–∫–ª—é—á–µ–Ω–Ω—è –∑ —Å—Ç—É–¥—ñ—ó" : "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...")
                    </h5>
                    <small class="text-muted">–ó–∞—Ä–∞–∑ —á—É—é—Ç—å –≤–∞—à—ñ —Å–ª—É—Ö–∞—á—ñ</small>
                </div>
                <button class="btn btn-sm btn-outline-secondary" onclick="syncMonitor()">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
        </div>
    }

    <hr class="my-5" />

    <div class="row mb-3 align-items-center">
        <div class="col">
            <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –ü–ª–µ–π–ª–∏—Å—Ç–∞</h2>
            <p class="text-muted">
                @if(isMicLive) 
                { 
                    <span class="text-warning"><i class="bi bi-exclamation-triangle"></i> –ï—Ñ—ñ—Ä –π–¥–µ –∑ –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É. –¶–µ–π –ø–ª–µ–π–ª–∏—Å—Ç –Ω–∞ –ø–∞—É–∑—ñ.</span> 
                } 
                else 
                { 
                    <span>–ö–µ—Ä—É–π—Ç–µ —á–µ—Ä–≥–æ—é —Ç—Ä–µ–∫—ñ–≤.</span> 
                }
            </p>
        </div>
    </div>

    @if (playlist != null && playlist.Any())
    {
        <div class="card shadow-sm mb-5" style="@(isMicLive ? "opacity: 0.6; pointer-events: none;" : "")">
            <div class="card-body p-0">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 50px;">#</th>
                            <th style="width: 60px;">–°–æ—Ä—Ç</th>
                            <th>–ù–∞–∑–≤–∞ —Ç—Ä–µ–∫—É</th>
                            <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th>
                            <th class="text-end">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int rowNum = 1; }
                        @foreach (var item in playlist)
                        {
                            string rowClass = item.IsActive ? "" : "table-secondary text-muted text-decoration-line-through";
                            
                            // –Ø–∫—â–æ DB Live - –ø—ñ–¥—Å–≤—ñ—á—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Ç—Ä–µ–∫ (–ª–æ–≥—ñ–∫—É –ø—ñ–¥—Å–≤—ñ—Ç–∫–∏ —Ä–æ–±–∏—Ç—å JS –∑–Ω–∏–∑—É)
                            <tr id="row-@item.TrackId" class="@rowClass transition-colors">
                                <td class="fw-bold text-secondary">@(rowNum++)</td>
                                <td>
                                    @if (!isAnyLive) // –î–æ–∑–≤–æ–ª—è—î–º–æ —Å–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –æ—Ñ–ª–∞–π–Ω
                                    {
                                        <div class="btn-group-vertical btn-group-sm">
                                            @if (item != playlist.First()) {
                                                <form asp-action="ChangeStreamQueuePosition" method="post">
                                                    <input type="hidden" name="queueId" value="@item.QueueId" /><input type="hidden" name="direction" value="up" />
                                                    <button type="submit" class="btn btn-light border py-0"><i class="bi bi-caret-up-fill"></i></button>
                                                </form>
                                            }
                                            @if (item != playlist.Last()) {
                                                <form asp-action="ChangeStreamQueuePosition" method="post">
                                                    <input type="hidden" name="queueId" value="@item.QueueId" /><input type="hidden" name="direction" value="down" />
                                                    <button type="submit" class="btn btn-light border py-0"><i class="bi bi-caret-down-fill"></i></button>
                                                </form>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="text-muted">‚Äî</span>
                                    }
                                </td>
                                <td><span class="fw-bold">@item.Track.Title</span></td>
                                <td>@item.Track.Duration.ToString(@"mm\:ss")</td>
                                <td class="text-end">
                                    @if (isDbLive) 
                                    {
                                        @if (item.IsActive) { <span class="badge bg-success">–í —Ä–æ—Ç–∞—Ü—ñ—ó</span> } else { <span class="badge bg-secondary">–ü—Ä–æ–ø—É—â–µ–Ω–æ</span> }
                                    }
                                    else if (!isAnyLive) // –ö–Ω–æ–ø–∫–∏ –∞–∫—Ç–∏–≤–Ω—ñ —Ç—ñ–ª—å–∫–∏ –æ—Ñ–ª–∞–π–Ω
                                    {
                                        <form asp-action="ToggleTrackActive" method="post">
                                            <input type="hidden" name="queueId" value="@item.QueueId" />
                                            @if (item.IsActive) {
                                                <button type="submit" class="btn btn-sm btn-outline-warning"><i class="bi bi-slash-circle"></i> –°–∫—ñ–ø–Ω—É—Ç–∏</button>
                                            } else {
                                                <button type="submit" class="btn btn-sm btn-outline-success"><i class="bi bi-play-circle"></i> –í—ñ–¥–Ω–æ–≤–∏—Ç–∏</button>
                                            }
                                        </form>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-warning">–ü–ª–µ–π–ª–∏—Å—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π.</div>
    }

    <hr class="my-5" />
    <h3>–Ü—Å—Ç–æ—Ä—ñ—è —Å–µ—Å—ñ–π</h3>
    <table class="table table-striped">
        <thead><tr><th>–ü–æ—á–∞—Ç–æ–∫</th><th>–ö—ñ–Ω–µ—Ü—å</th><th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
        <tbody>
            @foreach (var stream in Model)
            {
                <tr>
                    <td>@stream.StartTime.ToLocalTime().ToString("g")</td>
                    <td>@(stream.EndTime.HasValue ? stream.EndTime.Value.ToLocalTime().ToString("g") : "-")</td>
                    <td>@if(stream.EndTime.HasValue){ var d = stream.EndTime.Value - stream.StartTime; <span>@d.ToString(@"hh\:mm") –≥–æ–¥</span> } else { <span class="text-success">–¢—Ä–∏–≤–∞—î...</span> }</td>
                    <td>@if(stream.EndTime == null){ <span class="badge bg-success">Active</span> } else { <span class="badge bg-secondary">Finished</span> }</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
<style>
    .transition-colors { transition: background-color 0.5s ease; }
    .animate-pulse { animation: pulse 2s infinite; }
    @@keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
</style>

<script>
    // === –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ===
    let mediaRecorder;
    let socket;
    var stationId = '@ViewBag.StationId'; // –û—Ç—Ä–∏–º—É—î–º–æ ID —Å—Ç–∞–Ω—Ü—ñ—ó –≥–ª–æ–±–∞–ª—å–Ω–æ

    // === 1. –§–£–ù–ö–¶–Ü–Ø –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–á (–í–∏–Ω–µ—Å–µ–Ω–∞ –Ω–∞–≥–æ—Ä—É) ===
    async function syncMonitor() {
        var monitorTitle = document.getElementById('monitorTitle');
        // –Ø–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ–º–∞—î –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —â–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è), –≤–∏—Ö–æ–¥–∏–º–æ
        if (!monitorTitle) return;

        try {
            let response = await fetch('/Home/GetRadioStatus?stationId=' + stationId + '&t=' + new Date().getTime());
            if (response.ok) {
                let status = await response.json();
                
                // –Ø–∫—â–æ —Ü–µ Live Stream (–º—ñ–∫—Ä–æ—Ñ–æ–Ω)
                if (status.isLiveStream) {
                        monitorTitle.innerText = "üéôÔ∏è –ü—Ä—è–º–µ –≤–∫–ª—é—á–µ–Ω–Ω—è –∑ —Å—Ç—É–¥—ñ—ó";
                        document.getElementById('monitorStatus').innerText = "LIVE INPUT";
                        document.getElementById('monitorStatus').className = "badge bg-danger animate-pulse";
                        return;
                }

                // –Ø–∫—â–æ —Ü–µ –ü–ª–µ–π–ª–∏—Å—Ç
                if (status.startTrackId) {
                    var currentTrack = status.playlist.find(t => t.trackId === status.startTrackId);
                    if (currentTrack) {
                        monitorTitle.innerText = "üéµ " + currentTrack.title;
                        document.getElementById('monitorStatus').innerText = "Auto-DJ";
                        document.getElementById('monitorStatus').className = "badge bg-success";
                    }
                    highlightRow(status.startTrackId);
                } else {
                    // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –≥—Ä–∞—î
                    if(!status.isLiveStream) {
                            monitorTitle.innerText = "–û—Ñ–ª–∞–π–Ω";
                            document.getElementById('monitorStatus').innerText = "Offline";
                            document.getElementById('monitorStatus').className = "badge bg-secondary";
                    }
                }
            }
        } catch (e) { console.error(e); }
    }

    function highlightRow(activeTrackId) {
        document.querySelectorAll('tr').forEach(row => {
            if (!row.classList.contains('table-secondary')) row.classList.remove('table-primary', 'fw-bold');
        });
        if (activeTrackId) {
            var row = document.getElementById('row-' + activeTrackId);
            if (row) row.classList.add('table-primary', 'fw-bold');
        }
    }

    // === 2. –õ–û–ì–Ü–ö–ê –î–õ–Ø LIVE STREAMING ===
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–ø–∏—Å–∫—É –º—ñ–∫—Ä–æ—Ñ–æ–Ω—ñ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const select = document.getElementById('audioSource');
        if(select) {
            navigator.mediaDevices.enumerateDevices().then(devices => {
                devices.filter(d => d.kind === 'audioinput').forEach(device => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.text = device.label || `Microphone ${select.length + 1}`;
                    select.appendChild(option);
                });
            }).catch(err => console.log("Mic permission needed"));
        }

        // –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç–∞–π–º–µ—Ä —Ç—É—Ç
        initTimer();
        
        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
        syncMonitor();
        setInterval(syncMonitor, 5000);
    });

    async function startStreaming() {
        const btn = document.getElementById('btnStartMic');
        const statusDiv = document.getElementById('connectionStatus');
        const sourceSelect = document.getElementById('audioSource');
        
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> –ó–∞–ø—É—Å–∫...';
        statusDiv.classList.remove('d-none');
        statusDiv.innerText = "–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞—É–¥—ñ–æ...";

        try {
            const deviceId = sourceSelect.value;
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    deviceId: deviceId ? { exact: deviceId } : undefined,
                    echoCancellation: false,
                    autoGainControl: false,
                    noiseSuppression: false,
                    channelCount: 2 
                }
            });

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            socket = new WebSocket(`${protocol}//${window.location.host}/ws/stream`);

            socket.onopen = () => {
                statusDiv.className = "alert alert-success";
                statusDiv.innerText = "üî¥ –ó'—î–¥–Ω–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –í–∏ –≤ –µ—Ñ—ñ—Ä—ñ.";
                
                btn.disabled = false;
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-dark', 'animate-pulse');
                btn.innerHTML = '<i class="bi bi-stop-circle"></i> –ó–ê–í–ï–†–®–ò–¢–ò –ï–§–Ü–†';
                btn.onclick = stopStreaming;

                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0 && socket.readyState === 1) {
                        socket.send(event.data);
                    }
                };

                mediaRecorder.start(250);
                
                document.getElementById('audioSource').disabled = true;
                
                // –¢–µ–ø–µ—Ä —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞
                setTimeout(syncMonitor, 2000);
            };

            socket.onerror = (e) => {
                console.error(e);
                alert("–ü–æ–º–∏–ª–∫–∞ WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è");
                resetUI();
            };

            socket.onclose = () => {
                console.log("Socket closed");
                resetUI();
            };

        } catch (err) {
            console.error(err);
            alert("–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É: " + err.message);
            resetUI();
        }
    }

    function stopStreaming() {
        if(mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop();
        if(socket) socket.close();
        setTimeout(() => window.location.reload(), 500);
    }

    function resetUI() {
        const btn = document.getElementById('btnStartMic');
        const statusDiv = document.getElementById('connectionStatus');
        
        btn.disabled = false;
        btn.innerHTML = '<i class="bi bi-broadcast"></i> –í–∏–π—Ç–∏ –≤ Live –ï—Ñ—ñ—Ä';
        btn.classList.add('btn-danger');
        btn.classList.remove('btn-dark', 'animate-pulse');
        btn.onclick = startStreaming;
        
        document.getElementById('audioSource').disabled = false;
        statusDiv.classList.add('d-none');
    }

    // === 3. –¢–ê–ô–ú–ï–† ===
    function initTimer() {
        var startTimeStr = '@ViewBag.StreamStartTime';
        if (startTimeStr) {
            var startTime = new Date(startTimeStr);
            var timerElement = document.getElementById('liveTimer');
            if(timerElement) {
                setInterval(() => {
                    var now = new Date();
                    var diff = Math.floor((now - startTime) / 1000);
                    if (diff < 0) diff = 0;
                    var h = Math.floor(diff / 3600).toString().padStart(2, '0');
                    var m = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
                    var s = (diff % 60).toString().padStart(2, '0');
                    timerElement.innerText = `${h}:${m}:${s}`;
                }, 1000);
            }
        }
    }
</script>
}